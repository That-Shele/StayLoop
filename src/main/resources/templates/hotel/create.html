
<!DOCTYPE html>
<html lang="es"

      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="/layouts/_mainLayout" xmlns="http://www.w3.org/1999/html">

<div layout:fragment="content" class="flex-grow bg-[var(--background-color)] items-center">
  <div class="mx-auto max-w-4xl px-4 py-8 sm:px-6 lg:px-8">
    <div class="space-y-12">
      <header>
        <h1 class="text-4xl font-extrabold tracking-tight text-[var(--text-primary)]">Crea un Nuevo Hotel</h1>
        <p class="mt-2 text-lg text-[var(--text-secondary)]">Rellena los campos del formulario</p>
      </header>
      <div >
        <form th:action="@{/hotel/save}" th:object="${hotelForm}" class="space-y-12 md:col-span-2" method="post" enctype="multipart/form-data">
          <input type="hidden" name="authCheck" value="authCreate">
          <section class="space-y-6 rounded-2xl border border-[var(--border-color)] bg-white p-6 shadow-sm" id="basic-info">
            <h3 class="text-xl font-bold text-[var(--text-primary)]">Información Básica</h3>

            <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
              <span th:if="${#fields.hasErrors('nombre')}" th:errors="*{nombre}" class="text-red-400 flex flex-col"></span>
              <span th:if="${#fields.hasErrors('idZona')}" th:errors="*{idZona}" class="text-red-400 flex flex-col"></span>
            </div>
            <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
              <label class="flex flex-col"><span class="mb-1 text-sm font-medium">Nombre del Hotel</span><input class="form-input h-12 rounded-xl border-[var(--border-color)] bg-white placeholder:text-[var(--text-secondary)] focus:border-[var(--primary-color)] focus:ring-[var(--primary-color)]" placeholder="e.g., The Grand Budapest Hotel" type="text" th:field="*{nombre}" id="nombre"/></label>
              <label class="flex flex-col"><span class="mb-1 text-sm font-medium">Zona</span>
                <select class="form-select h-12 rounded-xl border-[var(--border-color)] bg-white text-[var(--text-secondary)] focus:border-[var(--primary-color)] focus:ring-[var(--primary-color)]" name="idZona" id="idZona">
                  <option value=-1>Seleccione una zona</option>
                  <option th:each="zona : ${zonas}" th:value="${zona.id}" th:text="${zona.nombre}"></option>
                </select></label>
            </div>
          </section>
          <section class="space-y-6 rounded-2xl border border-[var(--border-color)] bg-white p-6 shadow-sm" id="location">
            <h3 class="text-xl font-bold text-[var(--text-primary)]">Direccion</h3>
            <span th:if="${#fields.hasErrors('direccion')}" th:errors="*{direccion}" class="text-red-400"></span>
            <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
              <label class="flex flex-col sm:col-span-2"><span class="mb-1 text-sm font-medium">Direccion completa</span><input class="form-input h-12 rounded-xl border-[var(--border-color)] bg-white placeholder:text-[var(--text-secondary)] focus:border-[var(--primary-color)] focus:ring-[var(--primary-color)]" placeholder="Direccion aquí..." th:field="*{direccion}" type="text" id="direccion"/></label>
            </div>
          </section>
          <section class="space-y-6 rounded-2xl border border-[var(--border-color)] bg-white p-6 shadow-sm" id="description">
            <h3 class="text-xl font-bold text-[var(--text-primary)]">Descripción</h3>
            <span th:if="${#fields.hasErrors('descripcion')}" th:errors="*{descripcion}" class="text-red-400"></span>
            <div class="space-y-4">
              <label class="flex flex-col"><span class="mb-1 text-sm font-medium">Describa su hotel</span><textarea class="form-textarea min-h-32 rounded-xl border-[var(--border-color)] bg-white placeholder:text-[var(--text-secondary)] focus:border-[var(--primary-color)] focus:ring-[var(--primary-color)]" placeholder="Que hace a nuestro hotel tan especial?" th:field="*{descripcion}" id="descripcion"></textarea></label>
            </div>
          </section>
          <section class="space-y-6 rounded-2xl border border-gray-200 bg-white p-6 shadow-sm">
            <h3 class="text-xl font-bold text-gray-800">Fotos del Hotel</h3>

            <div id="image-upload-container" class="flex flex-wrap gap-4">

              <div id="image-preview-container" class="flex flex-wrap gap-4">
              </div>

              <div id="add-new-button-container">
                <label for="file-input-0" class="flex h-32 w-32 cursor-pointer flex-col items-center justify-center gap-2 rounded-xl border-2 border-dashed border-gray-300 bg-gray-50 text-center hover:bg-gray-100">
                  <svg class="h-10 w-10 text-gray-400" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                  </svg>
                  <span class="text-sm font-medium text-gray-500">Añadir foto</span>
                  <span th:if="${#fields.hasErrors('imagenes')}" th:errors="*{imagenes}" class="text-red-400"></span>
                  <input type="file" id="file-input-0" name="images" accept="image/*" class="hidden" onchange="handleImageUpload(event)">
                </label>
              </div>

            </div>
          </section>
          <section class="space-y-6 rounded-2xl border border-gray-200 bg-white p-6 shadow-sm">
            <h3 class="text-xl font-bold text-gray-800">Tipos de Habitación</h3>

            <div id="room-types-container" class="space-y-8">

              <div class="room-type-block relative rounded-lg border border-gray-200 p-4 pt-8">
                <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">

                  <label class="flex flex-col">
                    <span class="mb-1 text-sm font-medium">Nombre del Tipo de Habitación</span>

                    <input type="text" th:field="*{tiposHabitacion[0].nombre}" class="form-input" placeholder="Ej: Suite Deluxe">
                  </label>

                  <label class="flex flex-col">
                    <span class="mb-1 text-sm font-medium">Capacidad de Personas</span>
                    <input type="number" th:field="*{tiposHabitacion[0].cantPersonas}" class="form-input" placeholder="Ej: 2">
                  </label>

                  <label class="flex flex-col">
                    <span class="mb-1 text-sm font-medium">Precio por Noche ($)</span>
                    <input type="number" step="0.01" th:field="*{tiposHabitacion[0].costo}" class="form-input" placeholder="Ej: 150.00">
                  </label>

                  <label class="flex flex-col">
                    <span class="mb-1 text-sm font-medium">Cantidad de Habitaciones</span>
                    <input type="number" th:field="*{tiposHabitacion[0].cantHab}" class="form-input" placeholder="Ej: 10">
                  </label>

                </div>
              </div>

            </div> <button id="add-room-type-btn" type="button" class="mt-4 flex items-center gap-2 rounded-full bg-gray-100 px-5 py-2.5 text-sm font-bold text-gray-800 hover:bg-gray-200">
            <svg fill="currentColor" height="16" viewBox="0 0 256 256" width="16" xmlns="http://www.w.org/2000/svg">
              <path d="M224,128a8,8,0,0,1-8,8H136v80a8,8,0,0,1-16,0V136H40a8,8,0,0,1,0-16h80V40a8,8,0,0,1,16,0v80h80A8,8,0,0,1,224,128Z"></path>
            </svg>
            <span>Añadir otro Tipo de Habitación</span>
          </button>
          </section>
          <div class="flex items-center justify-end gap-4 pt-6">
            <a class="rounded-full bg-[var(--secondary-color)] px-6 py-3 text-base font-bold text-[var(--text-primary)] hover:bg-red-500 hover:text-white transition-colors" type="button">Cancelar</a>
            <button class="rounded-full bg-[var(--primary-color)] px-6 py-3 text-base font-bold text-white shadow-lg hover:bg-green-600 transition-colors" type="submit">Create Hotel</button>
          </div>
        </form>
        <script>
          // Variable para llevar la cuenta de los inputs de archivo y asignarles un ID único
let fileInputCounter = 0;

function handleImageUpload(event) {
    const input = event.target;
    if (!input.files || !input.files[0]) return;

    const file = input.files[0];
    const previewContainer = document.getElementById('image-preview-container');
    const newButtonContainer = document.getElementById('add-new-button-container');

    // 1. Crear la vista previa de la imagen
    const reader = new FileReader();
    reader.onload = function(e) {
        // Contenedor para la imagen y el botón de eliminar
        const imageWrapper = document.createElement('div');
        imageWrapper.classList.add('relative', 'h-32', 'w-32');

        // La imagen de previsualización
        const img = document.createElement('img');
        img.src = e.target.result;
        img.classList.add('h-full', 'w-full', 'rounded-xl', 'object-cover');
        imageWrapper.appendChild(img);

        // Botón para eliminar la imagen
        const deleteButton = document.createElement('button');
        deleteButton.innerHTML = '&times;'; // '×' character
        deleteButton.classList.add('absolute', 'top-1', 'right-1', 'flex', 'h-6', 'w-6', 'items-center', 'justify-center', 'rounded-full', 'bg-red-600', 'text-white', 'font-bold', 'text-lg', 'hover:bg-red-700');
        deleteButton.onclick = function() {
            // Al hacer clic, eliminamos el contenedor de la imagen y el input de archivo asociado
            imageWrapper.remove();
            input.remove(); // Asegura que el archivo no se envíe
        };
        imageWrapper.appendChild(deleteButton);

        // Añadir la vista previa al contenedor
        previewContainer.appendChild(imageWrapper);
    };
    reader.readAsDataURL(file);

    // 2. Ocultar el label del input que acabamos de usar
    const label = input.parentElement;
    label.style.display = 'none';

    // 3. Crear y añadir dinámicamente un nuevo botón de subida
    fileInputCounter++;
    const newFileInputId = `file-input-${fileInputCounter}`;

    const newLabel = document.createElement('label');
    newLabel.setAttribute('for', newFileInputId);
    newLabel.className = 'flex h-32 w-32 cursor-pointer flex-col items-center justify-center gap-2 rounded-xl border-2 border-dashed border-gray-300 bg-gray-50 text-center hover:bg-gray-100';

    newLabel.innerHTML = `
        <svg class="h-10 w-10 text-gray-400" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
        </svg>
        <span class="text-sm font-medium text-gray-500">Añadir foto</span>
        <input type="file" id="${newFileInputId}" name="images" accept="image/*" class="hidden" onchange="handleImageUpload(event)">
    `;

    newButtonContainer.appendChild(newLabel);
}


          document.addEventListener('DOMContentLoaded', function() {

    // El índice comienza en 1 porque el primer elemento (índice 0) ya está en el HTML.
    let roomTypeIndex = 1;

    const addRoomBtn = document.getElementById('add-room-type-btn');
    const container = document.getElementById('room-types-container');

    // Función para añadir un nuevo bloque de tipo de habitación
    addRoomBtn.addEventListener('click', function() {
        // Creamos un nuevo div que contendrá el formulario
        const newRoomTypeBlock = document.createElement('div');
        newRoomTypeBlock.classList.add('room-type-block', 'relative', 'rounded-lg', 'border', 'border-gray-200', 'p-4', 'pt-8', 'mt-8');

        // Usamos una plantilla de texto para generar el HTML interno del nuevo bloque
        // Fíjate cómo usamos `roomTypeIndex` para los atributos 'name' e 'id'
        const blockHTML = `
            <button type="button" class="remove-room-type-btn absolute top-2 right-2 flex h-6 w-6 items-center justify-center rounded-full bg-red-100 text-red-600 hover:bg-red-200" title="Eliminar este tipo de habitación">
                &times;
            </button>
            <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
                <label class="flex flex-col">
                    <span class="mb-1 text-sm font-medium">Nombre del Tipo de Habitación</span>
                    <input type="text" name="tiposHabitacion[${roomTypeIndex}].nombre" class="form-input" placeholder="Ej: Suite Deluxe">
                </label>

                <label class="flex flex-col">
                    <span class="mb-1 text-sm font-medium">Capacidad de Personas</span>
                    <input type="number" name="tiposHabitacion[${roomTypeIndex}].cantPersonas" class="form-input" placeholder="Ej: 2">
                </label>

                <label class="flex flex-col">
                    <span class="mb-1 text-sm font-medium">Precio por Noche ($)</span>
                    <input type="number" step="0.01" name="tiposHabitacion[${roomTypeIndex}].costo" class="form-input" placeholder="Ej: 150.00">
                </label>

                <label class="flex flex-col">
                    <span class="mb-1 text-sm font-medium">Cantidad de Habitaciones</span>
                    <input type="number" name="tiposHabitacion[${roomTypeIndex}].cantHab" class="form-input" placeholder="Ej: 10">
                </label>
            </div>
        `;

        newRoomTypeBlock.innerHTML = blockHTML;
        container.appendChild(newRoomTypeBlock);

        // Incrementamos el índice para el próximo elemento que se añada
        roomTypeIndex++;
    });

    // Delegación de eventos para manejar la eliminación de bloques
    container.addEventListener('click', function(event) {
        // Verificamos si el clic fue en un botón de eliminar
        if (event.target && event.target.classList.contains('remove-room-type-btn')) {
            // Buscamos el div padre (.room-type-block) y lo eliminamos del DOM
            event.target.closest('.room-type-block').remove();
        }
    });

});
        </script>

      </div>
    </div>
  </div>
</div>
